####
#Header block that defines the properties of this DTC
####

#Type of DTC. Streaming or Window
#The Window DTC applies windows operations on top of sessionized data
Type: ProductML:DTC:Window
Version: '2018-03-01'
Description: Second Level processing for feature generation

Name: ProductMLExample

#The DTC used in Step 1
SourceDTC: offer_ai_v1

#Anchor defines the condition used to trigger the decision
#If an offer is shown to the user in this session, the session
#in which the offer is shown is the anchor

Anchor:

###
 Condition:  any(offer_type) in offer_ai_v1.game_stats.offer_type
 Max: 1

##
#Window aggregations are stored in S3 (a Store)
#Defines the Store properties
##

Store:
   - Type: ProductML:DTC:Storage:S3
     Name: s3
     Bucket: offer-ai-example
     Prefix: /dtc-test/window/


DataGroups:

 - Type: ProductML:DTC:DataGroup:AnchorAggregate
 Window:
     #Defines a processing window for the rollup. Supported window types are Day, Hour and Count
     Type: count
     #Negative values are backward from the Anchor
     Value: -1
     Source: offer_ai_v1.game_stats
     Name: prev_session

   Fields:
     - Name: games_played_last_session
       Type: integer
       Value: prev_session.games_played

     - Name: win_ratio_last_session
       Type: float
       Value: prev_session.win_ratio

 - Type: ProductML:DTC:DataGroup:AnchorAggregate
 Name: prev_week
   Window:
     - Type: day
       Values: -7
       Source: offer_ai_v1.game_stats
       Name: prev_week

   Fields:
     - Name: purchases_prev_week_amount
       Type: float
       Value: prev_week.purchase_amount
